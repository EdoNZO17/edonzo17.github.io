<!DOCTYPE html>
<!-- saved from url=(0051)file:///C:/Users/Edouard/Desktop/NewDash5_Test.html -->
<html lang="fr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>DORA - Audit de conformité</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="./DORA - Audit de conformité_files/chart.js.télécharger"></script>
<script src="./DORA - Audit de conformité_files/jspdf.umd.min.js.télécharger"></script>
<style>
:root {
  --sidebar-bg: #142850; --sidebar-text: #fff; --sidebar-active: #FFD600;
  --btn-yellow: #FFD600; --btn-hover: #305a8d;
  --main-bg: #f5f5f5;
  --title-blue-dark: #123864; --title-blue-light: #4a85d9;
}
html, body {margin:0;padding:0;height:100%;}
body {
  font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;
  background:var(--main-bg);
  color:#222;
}
#app {display:flex;height:100vh;}
aside.sidebar {
  width: 275px; background:var(--sidebar-bg); color:var(--sidebar-text);
  display:flex;flex-direction:column;align-items:stretch;
}
.sidebar-logo {height:30px;display:flex;align-items:center;justify-content:center;}
hr.separator {border:none;border-top:1px solid var(--sidebar-text);margin:1px 1px;}
nav.sidebar-menu {flex-grow:1;overflow-y:auto;padding-left:1px;}
nav.sidebar-menu .pilier {
  cursor:pointer;padding:5px 5px;border-left:4px solid transparent;
  border-radius:5px 0 0 5px;font-size:0.94rem;white-space:nowrap;user-select:none;
}

nav.sidebar-menu .pilier.selected {
  color:var(--sidebar-active); font-weight:bold; background:#2b4376; border-left-color:var(--sidebar-active);
}
nav.sidebar-menu .pilier:hover:not(.selected){background:#1a2a59;}
.btn-row {display:flex;gap:12px;justify-content:space-around;margin:5px 10px 10px 10px;}
button.btn-yellow{
  background:transparent; border:2px solid var(--btn-yellow);
  color:var(--btn-yellow); font-weight:bold; flex:1 1 calc(50% - 15px); padding:10px 0;
  font-size:0.95rem; cursor:pointer; border-radius:6px; user-select:none; text-align:center;
  transition:background-color .3s,color .3s;
}
button.btn-yellow:hover{background:var(--btn-yellow);color:var(--sidebar-bg);}
button.btn-green{
  background:#28a745;color:#fff;margin:10px 18px;font-weight:bold;
  padding:5px 0;border-radius:6px;cursor:pointer;border:none;user-select:none;font-size:1rem;width:calc(100% - 36px);
}
button.btn-green:hover{background:#1e7e34;}
button.btn-reset{
  background:none;border:2px solid #c62828;color:#c62828;font-weight:bold;
  padding:9px 0;margin:12px 18px 18px 18px;border-radius:6px;
  cursor:pointer; user-select:none; font-size:1rem; width:calc(100% - 36px);
  transition:background-color .3s,color .3s;
}
button.btn-reset:hover{background:#c62828;color:#fff;}
main.main-content{flex-grow:1;display:flex;flex-direction:column;overflow-y:auto;padding-bottom:6px;}
header.header-bar{
  background:#fff; padding:8px 28px 4px 28px; user-select:none; display:flex;align-items:center;justify-content:space-between;
}
.header-title{font-weight:700;font-size:2.25rem;color:var(--title-blue-dark);}
.header-gauge{width:260px; height:110px;}
.header-separator{border-top:2px solid #000;margin:10px 30px 8px 30px;}
.stats-btn-bar{display:flex;gap:16px;margin:10px 30px 20px 30px;user-select:none;}
.stats-btn{
  background:var(--sidebar-bg);color:#fff;border:none;
  border-radius:24px;min-width:130px;font-weight:700;font-size:1.02rem;
  padding:8px 16px;cursor:default;display:flex;justify-content:space-between;align-items:center;
}
#dashboard-graphs{padding:5px 30px 0 30px;display:block;flex-grow:1;overflow-y:auto;}
.center-graphs{display:flex;gap:24px;min-height:180px;margin-bottom:20px;}
.graph-card{
  background:white; flex:1; border-radius:14px; box-shadow:0 3px 7px #0004;
  display:flex;flex-direction:column;align-items:center;padding:12px 12px 6px 12px;
}
.graph-title{font-weight:700;color:var(--sidebar-bg);font-size:1.05rem;margin-bottom:8px;}
.piliers-detail-section{display:flex;flex-wrap:wrap;gap:14px;margin-bottom:28px;}
.pilier-card{border-radius:16px; background:white; box-shadow:0 0 12px #0003; padding:14px 18px 12px 18px; flex:1 1 360px; user-select:none;}
.pilier-card-title{font-weight:800;font-size:1.1rem;color:var(--title-blue-light);margin-bottom:4px;}
.card-stats{font-size:0.89em;color:#2a3552;margin-bottom:7px;}
.exigence-list{max-height:180px;overflow-y:auto;font-size:0.9rem;color:#232b4a;}
.exigence-item{display:flex;justify-content:space-between;margin:2px 0;border-bottom:1px solid #dbe2f3;padding-bottom:2px;color:#17204f;font-family:monospace;}
.exigence-status-symbol{font-weight:bold;min-width:32px;text-align:right;}

/* Couleurs des statuts */
.status-Non\ Evaluée{color:#636363;font-weight:bold;}
.status-Partielle{color:#e09200;}
.status-Conforme{color:#239E4F;font-weight:bold;}
.status-Non\ Conforme{color:#d60020;font-weight:bold;}
.status-Non\ Applicable{color:#222;}

/* --- Vue détaillée --- */
#pilier-details{padding:10px 34px 15px 34px;overflow-y:auto;flex-grow:1;user-select:text;}
.pilier-details-view {
  background:#f9fbff; border-radius:15px; box-shadow:0 2px 14px #0004;
  padding:20px 28px; border:1.5px solid var(--title-blue-dark); user-select:text;
}
.details-title{font-weight:900;font-size:1.47rem;color:var(--title-blue-dark);margin-bottom:8px;text-decoration:underline;}
.details-desc{font-style:italic;font-size:0.95rem;line-height:1.38;color:#304b8a;margin-bottom:14px;}
.hr{height:2px;background:var(--sidebar-active);border:none;border-radius:4px;margin-bottom:22px;}
.exigence-detail{padding:14px 16px 12px 16px;margin-bottom:18px;background:#e5f0ff;border-radius:14px;border:1.3px solid #acc7ff;}
.exigence-head{display:flex;justify-content:space-between;font-weight:900;font-size:1.03rem;color:var(--title-blue-dark);margin-bottom:6px;}
.exigence-code{font-family:monospace;}
select.exigence-status-select{
  width:190px; margin:8px 0 14px 0; padding:6px 10px;font-size:1rem; border-radius:6px;
  border:2px solid var(--title-blue-dark); background-color:#dbe4fc; color:var(--title-blue-dark); font-weight:700; user-select:text; cursor:pointer;
}
textarea.exigence-comments{
  width:100%; min-height:44px; border-radius:7px; font-size:0.92rem;
  border:1.4px solid #adc2e6; padding:6px 9px; resize:vertical; color:var(--title-blue-dark);
}
.proofs-area{margin-top:9px;}
.proof-row{display:flex;gap:6px;margin-bottom:6px;align-items:center;}
input.proof-text{flex-grow:1;font-family:monospace;font-size:0.92em;padding:5px 8px;border-radius:6px;border:1.4px solid #adc2e6;}
button.proof-attach-btn{font-size:1.08rem;background:var(--sidebar-bg);border:none;border-radius:6px;padding:4px 12px;cursor:pointer;color:var(--btn-yellow);font-weight:900;transition:background-color 0.25s;}
button.proof-attach-btn:hover{background:#0d2a4f;color:#fff;}
span.proof-file-name{font-size:0.83rem;color:#3260c7;font-family:monospace;}
input.hidden-file-input{display:none;}
@media (max-width:1050px){
  .center-graphs{flex-direction:column;gap:18px;min-height:380px;}
  .pilier-card{flex-basis:100%;}
}
</style>
</head>
<body>
<div id="app">
  <aside class="sidebar" aria-label="Menu des piliers DORA">
    <div class="sidebar-logo" aria-label="Zone logo"></div>
	     <img src="./DORA - Audit de conformité_files/enzosystemsJPG.JPG" alt="Logo">
    <hr class="separator">
    <nav class="sidebar-menu" id="sidebar-piliers" tabindex="0"><div tabindex="0" role="button" class="pilier" aria-selected="false" onclick="selectPilier(0)" onkeydown="if(event.key===&#39;Enter&#39;)selectPilier(0)">
      Pilier 1 : Gouvernance et organisation
    </div><div tabindex="0" role="button" class="pilier" aria-selected="false" onclick="selectPilier(1)" onkeydown="if(event.key===&#39;Enter&#39;)selectPilier(1)">
      Pilier 2 : Gestion des risques TIC
    </div><div tabindex="0" role="button" class="pilier" aria-selected="false" onclick="selectPilier(2)" onkeydown="if(event.key===&#39;Enter&#39;)selectPilier(2)">
      Pilier 3 : Gestion des incidents TIC
    </div><div tabindex="0" role="button" class="pilier" aria-selected="false" onclick="selectPilier(3)" onkeydown="if(event.key===&#39;Enter&#39;)selectPilier(3)">
      Pilier 4 : Tests de résilience
    </div><div tabindex="0" role="button" class="pilier" aria-selected="false" onclick="selectPilier(4)" onkeydown="if(event.key===&#39;Enter&#39;)selectPilier(4)">
      Pilier 5 : Gestion des tiers TIC
    </div><div tabindex="0" role="button" class="pilier" aria-selected="false" onclick="selectPilier(5)" onkeydown="if(event.key===&#39;Enter&#39;)selectPilier(5)">
      Pilier 6 : Partage de l’information
    </div><div style="height:24px"></div></nav>
    <div style="height:20px"></div>
    <hr class="separator">
    <div class="btn-row">
      <button class="btn-yellow" onclick="exportReport(&#39;html&#39;)">Export html</button>
      <button class="btn-yellow" onclick="exportReport(&#39;pdf&#39;)">Export pdf</button>
    </div>
    <div class="btn-row">
      <button class="btn-yellow" onclick="saveData()">Enregistrer</button>
      <button class="btn-yellow" onclick="triggerImport()">Importer</button>
      <input type="file" id="import-input" accept=".json" style="display:none" onchange="importData(event)">
    </div>
    <hr class="separator">
    <button class="btn-green" onclick="showDashboard()">Retour au Dashboard</button>
    <hr class="separator">
    <button class="btn-reset" onclick="resetDashboard()">Réinitialiser</button>
  </aside>
  <main class="main-content">
    <header class="header-bar">
      <div><h1 class="header-title">DORA - Audit de conformité</h1></div> <br>
      <div class="header-gauge"><canvas id="gauge-chart" style="box-sizing: border-box; display: block; height: 110px; width: 260px;" width="390" height="165"></canvas></div>
    </header>
    <div class="header-separator"></div>
    <section class="stats-btn-bar">
    <button class="stats-btn">35 Total exigences</button>
    <button class="stats-btn">0 Evaluées (0%)</button>
    <button class="stats-btn">0 Conf. Partielle (0%)</button>
    <button class="stats-btn">0 Non Conformes (0%)</button>
	<button class="stats-btn">0 Non Applicables (0%)</button>
    <button class="stats-btn">0 Conformes (0%)</button>
  </section>
    <section id="dashboard-graphs" style="display:block;">
      <div class="center-graphs">
        <section class="graph-card"><h2 class="graph-title">État d'ensemble (Radar)</h2><canvas id="star-chart" style="box-sizing: border-box; display: block; height: 300px; width: 300px;" width="450" height="450"></canvas></section>
        <section class="graph-card"><h2 class="graph-title">Statut Exigences par Pilier</h2><canvas id="bar-chart" style="box-sizing: border-box; display: block; height: 150px; width: 300px;" width="450" height="225"></canvas></section>
        <section class="graph-card"><h2 class="graph-title">Conformité Globale</h2><canvas id="doughnut-chart" style="box-sizing: border-box; display: block; height: 300px; width: 300px;" width="450" height="450"></canvas></section>
      </div>
      <div class="piliers-detail-section" id="dashboard-pilier-cards"><article class="pilier-card">
      <header class="pilier-card-title">Pilier 1 : Gouvernance et organisation</header>
      <div class="card-stats">Exigences: <strong>5</strong> | Evaluées: <strong>5</strong> | <span style="color:#239E4F">Conformes: <strong>0%</strong></span></div>
      <div class="exigence-list">
        <div class="exigence-item">
            <span>P1-E01: Implication dans la définition des politiques</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P1-E02: Budgétisation de la gestion des risques IT</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P1-E03: Supervision du plan de contrôle</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P1-E04: Organisation de la Comitologie et du Reporting internes</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P1-E05: Planification des réunions de suivi</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div>
      </div>
    </article><article class="pilier-card">
      <header class="pilier-card-title">Pilier 2 : Gestion des risques TIC</header>
      <div class="card-stats">Exigences: <strong>6</strong> | Evaluées: <strong>6</strong> | <span style="color:#239E4F">Conformes: <strong>0%</strong></span></div>
      <div class="exigence-list">
        <div class="exigence-item">
            <span>P2-E01: Cadre de gouvernance ICT</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P2-E02: Politiques de gestion des risques</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P2-E03: Inventaire des actifs ICT</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P2-E04: Politiques de sécurité de l'information</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P2-E05: Identification des vulnérabilités</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P2-E06: Gestion des changements ICT</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div>
      </div>
    </article><article class="pilier-card">
      <header class="pilier-card-title">Pilier 3 : Gestion des incidents TIC</header>
      <div class="card-stats">Exigences: <strong>6</strong> | Evaluées: <strong>6</strong> | <span style="color:#239E4F">Conformes: <strong>0%</strong></span></div>
      <div class="exigence-list">
        <div class="exigence-item">
            <span>P3-E01: Processus de détection des incidents</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P3-E02: Classification des incidents</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P3-E03: Notification aux autorités compétentes</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P3-E04: Registre des incidents</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P3-E05: Plan de communication de crise</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P3-E06: Analyse post-incident</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div>
      </div>
    </article><article class="pilier-card">
      <header class="pilier-card-title">Pilier 4 : Tests de résilience</header>
      <div class="card-stats">Exigences: <strong>6</strong> | Evaluées: <strong>6</strong> | <span style="color:#239E4F">Conformes: <strong>0%</strong></span></div>
      <div class="exigence-list">
        <div class="exigence-item">
            <span>P4-E01: Programme de tests de résilience</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P4-E02: Tests de pénétration (TLPT)</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P4-E03: Tests de continuité d'activité</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P4-E04: Documentation des résultats</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P4-E05: Plan d'amélioration continue</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P4-E06: Tests des services tiers</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div>
      </div>
    </article><article class="pilier-card">
      <header class="pilier-card-title">Pilier 5 : Gestion des tiers TIC</header>
      <div class="card-stats">Exigences: <strong>6</strong> | Evaluées: <strong>6</strong> | <span style="color:#239E4F">Conformes: <strong>0%</strong></span></div>
      <div class="exigence-list">
        <div class="exigence-item">
            <span>P5-E01: Registre des prestataires TIC</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P5-E02: Évaluation des risques de concentration</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P5-E03: Clauses contractuelles principales</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P5-E04: Stratégies de sortie</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P5-E05: Surveillance continue des prestataires</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P5-E06: Gestion des prestataires critiques</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div>
      </div>
    </article><article class="pilier-card">
      <header class="pilier-card-title">Pilier 6 : Partage de l’information</header>
      <div class="card-stats">Exigences: <strong>6</strong> | Evaluées: <strong>6</strong> | <span style="color:#239E4F">Conformes: <strong>0%</strong></span></div>
      <div class="exigence-list">
        <div class="exigence-item">
            <span>P6-E01: Partage des informations</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P6-E02: Renseignement sur les menaces (CTI)</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P6-E03: Indicateurs de compromission</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P6-E04: Alertes de cybersécurité</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P6-E05: Communautés de confiance</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div><div class="exigence-item">
            <span>P6-E06: Protection des données partagées</span>
            <span class="exigence-status-symbol" style="color:#636363;font-weight:bold">?</span>
          </div>
      </div>
    </article></div>
    </section>
    <section id="pilier-details" style="display:none;"></section>
  </main>
</div>
<script>

// Statuts et couleurs
const STATUS_LABELS = [
  {key:"Non évaluée",symbol:"?",color:"#636363",fontWeight:"bold"},
  {key:"Partielle",symbol:"+/-",color:"#e09200"},
  {key:"Conforme",symbol:"✓",color:"#239E4F",fontWeight:"bold"},
  {key:"Non Conforme",symbol:"NC",color:"#d60020",fontWeight:"bold"},
  {key:"Non Applicable",symbol:"##",color:"#222"}
];
function getStatusDef(statut){return STATUS_LABELS.find(s=>s.key===statut)||{symbol:"?",color:"#888"};}

// Exigences par pilier (reprend la structuration de ta demande)
const PILIERS = [
  {
    numero:1, titre:"Gouvernance et organisation", description:"La Direction doit s'impliquer dans la gestion des risques et la résilience.",
    objectifs:"La Direction doit définir, valider et superviser le déploiement du cadre (politiques, stratégies, procédures et outils) de gestion des risques informatiques.",
    exigences: [
      {titre:"Implication dans la définition des politiques", description:"Validation explicite des politiques de sécurité."},
      {titre:"Budgétisation de la gestion des risques IT", description:"Allocation des budgets spécifiques de gestion des risques IT."},
      {titre:"Supervision du plan de contrôle", description:"Supervision du plan de contrôle IT."},
      {titre:"Organisation de la Comitologie et du Reporting internes", description:"Mettre en place des comités et des canaux de reporting interne."},
      {titre:"Planification des réunions de suivi", description:"Planifier plusieurs points de reporting et de suivi avec le RSSI."},
    ]
  },
  {
    numero:2, titre:"Gestion des risques TIC", description:"Mettre en place une stratégie globale de gestion des risques.",
    objectifs:"Etablir un cadre pour identifier, protéger, détecter, répondre et récupérer des risques liés aux technologies de l’information et de la communication (TIC).",
    exigences: [
      {titre:"Cadre de gouvernance ICT", description:"Gouvernance claire et responsabilités définies."},
      {titre:"Politiques de gestion des risques", description:"Rédaction & mise à jour régulière de la politique."},
      {titre:"Inventaire des actifs ICT", description:"Mise à jour, exhaustivité, accès maîtrisé."},
      {titre:"Politiques de sécurité de l'information", description:"Existence, communication, diffusion large."},
      {titre:"Identification des vulnérabilités", description:"Dispositif de veille, scans réguliers."},
      {titre:"Gestion des changements ICT", description:"Processus formalisé, validation, documentation."}
    ]
  },
  {
    numero:3, titre:"Gestion des incidents TIC", description:"Préparation, traitement et analyse des incidents IT/TIC.",
    objectifs:"Mettre en place un processus pour détecter, classer, et signaler les incidents TIC aux autorités compétentes.",
    exigences: [
      {titre:"Processus de détection des incidents", description:"Logs journalisés, SIEM, alerting."},
      {titre:"Classification des incidents", description:"Grille d'impacts/intégrité dispo."},
      {titre:"Notification aux autorités compétentes", description:"Procédure conforme réglementation."},
      {titre:"Registre des incidents", description:"Base de données incidents, mises à jour régulières."},
      {titre:"Plan de communication de crise", description:"Support & média, plan testé."},
      {titre:"Analyse post-incident", description:"Rétrospective, plan correctif."}
    ]
  },
  {
    numero:4, titre:"Tests de résilience", description:"Organisation de tests robustes, simulations et retours d'expérience.",
    objectifs:"Valider l’efficacité réelle des dispositifs lors d’exercices concrets ciblés.",
    exigences: [
      {titre:"Programme de tests de résilience", description:"Plan pluriannuel, couverture large."},
      {titre:"Tests de pénétration (TLPT)", description:"Réalisation annuelle, prestataire qualifié."},
      {titre:"Tests de continuité d'activité", description:"Procédure, fréquence annualisée."},
      {titre:"Documentation des résultats", description:"Preuves, reporting systématisé."},
      {titre:"Plan d'amélioration continue", description:"Intégration des enseignements/test."},
      {titre:"Tests des services tiers", description:"Implication des prestataires dans les tests."}
    ]
  },
  {
    numero:5, titre:"Gestion des tiers TIC", description:"S’assurer que les prestataires respectent les normes et règles de l'art en matière de sécurité de l'information.",
    objectifs:"Gérer les dépendances par rapport aux sous-traitants pour éviter les risques systémiques ou réglementaires; c'est à dire, exiger des clauses de sécurité dans les contrats fournisseurs ainsi que leur niveau de maturité cyber pour s'assurer de leur conformité aux exigences de DORA.",
    exigences: [
      {titre:"Registre des prestataires TIC", description:"Liste exhaustive, revue semestrielle."},
      {titre:"Évaluation des risques de concentration", description:"Analyse dépendance multi-prestataires."},
      {titre:"Clauses contractuelles principales", description:"Revue juridique des contrats."},
      {titre:"Stratégies de sortie", description:"Scénarios d'arrêt, test annuel."},
      {titre:"Surveillance continue des prestataires", description:"Monitoring et contrôles."},
      {titre:"Gestion des prestataires critiques", description:"Cartographie, procédures dédiées."}
    ]
  },
  {
    numero:6, titre:"Partage de l’information", description:"Réaliser une veille sur les menaces et renforcer la sécurité collective par le partage des informations entre professionnels et aussi les autorités.",
    objectifs:"Favoriser la coopération sectorielle et maintenir la confidentialité et la conformité par la mise en place des politiques de confidentialité (classification des informations) pour identifier les informations pouvant être partagées.",
    exigences: [
      {titre:"Partage des informations", description:"Plateformes d'échange, adhésion groupes."},
      {titre:"Renseignement sur les menaces (CTI)", description:"Veille CTI, bulletins reçus, analysés."},
      {titre:"Indicateurs de compromission", description:"IOC intégrés processus SOC."},
      {titre:"Alertes de cybersécurité", description:"Diffusion rapide en interne."},
      {titre:"Communautés de confiance", description:"Membres de communautés sectorielles."},
      {titre:"Protection des données partagées", description:"Chiffrement, cloisonnement de données."}
    ]
  }
];

// Prépare les données exigences, structure finale
function makeFullPiliers(){
  return PILIERS.map(p=>{
    return {...p, exigences: p.exigences.map((e,i)=>({
      code:`P${p.numero}-E${String(i+1).padStart(2,"0")}`,
      titre:e.titre,
      description:e.description,
      statut:"Non évaluée",
      commentaires:"",
      preuves:["","","","",""],
      fichiers:[null,null,null,null,null]
    }))
  }});
}
let pilierData = makeFullPiliers();
if(localStorage.getItem('dora_audit_full')){
  try{pilierData=JSON.parse(localStorage.getItem('dora_audit_full'));}catch{}
}

let selectedPilier = null;

// ---- UI core ----
function renderSidebar(){
  document.getElementById('sidebar-piliers').innerHTML = pilierData.map((p,i)=>
    `<div tabindex="0" role="button" class="pilier${selectedPilier===i?' selected':''}" aria-selected="${selectedPilier===i}"
      onclick="selectPilier(${i})" onkeydown="if(event.key==='Enter')selectPilier(${i})">
      Pilier ${p.numero} : ${p.titre}
    </div>`).join('')+"<div style='height:24px'></div>";
}
function computeStats() {
  let total=0, evalues=0, partielles=0, conformes=0, nonconformes=0, nonapplicables=0;
  pilierData.forEach(p=>{
    p.exigences.forEach(e=>{
      total++;
      if(e.statut!=="Non évaluée") evalues++;
      if(e.statut==="Partielle") partielles++;
      if(e.statut==="Conforme") conformes++;
      if(e.statut==="Non Conforme") nonconformes++;
      if(e.statut==="Non Applicable") nonapplicables++;	  
    });
  });
  return {total,evalues,partielles,conformes,nonconformes,nonapplicables,taux:total?Math.round(100*conformes/total):0};
}
function renderStatsBar(){
  const s = computeStats();
  document.querySelector(".stats-btn-bar").innerHTML = `
    <button class="stats-btn">${s.total} Total exigences</button>
    <button class="stats-btn">${s.evalues} Evaluées (${Math.round(100*s.evalues/s.total||0)}%)</button>
    <button class="stats-btn">${s.partielles} Conf. Partielle (${Math.round(100*s.partielles/s.total||0)}%)</button>
    <button class="stats-btn">${s.nonconformes} Non Conformes (${Math.round(100*s.nonconformes/s.total||0)}%)</button>
	<button class="stats-btn">${s.nonapplicables} Non Applicables (${Math.round(100*s.nonapplicables/s.total||0)}%)</button>
    <button class="stats-btn">${s.conformes} Conformes (${Math.round(100*s.conformes/s.total||0)}%)</button>
  `;
}
function renderPilierCards(){
  document.getElementById('dashboard-pilier-cards').innerHTML = pilierData.map(p=>{
    const total=p.exigences.length, evalues=p.exigences.filter(e=>e.statut!=="Non évalué").length, conformes=p.exigences.filter(e=>e.statut==="Conforme").length;
    return `<article class="pilier-card">
      <header class="pilier-card-title">Pilier ${p.numero} : ${p.titre}</header>
      <div class="card-stats">Exigences: <strong>${total}</strong> | Evaluées: <strong>${evalues}</strong> | <span style="color:#239E4F">Conformes: <strong>${Math.round(100*conformes/total||0)}%</strong></span></div>
      <div class="exigence-list">
        ${p.exigences.map(e=>{
          const s=getStatusDef(e.statut);
          return `<div class="exigence-item">
            <span>${e.code}: ${e.titre}</span>
            <span class="exigence-status-symbol" style="color:${s.color};font-weight:${s.fontWeight||'normal'}">${s.symbol}</span>
          </div>`;
        }).join('')}
      </div>
    </article>`;
  }).join('');
}

// ----- Charts -----
let gaugeChart, barChart, doughnutChart, starChart;
function renderCharts(){
  const s = computeStats();
  updateGauge(s.taux);
  if(barChart) barChart.destroy();
  const labels=["Conforme","Partielle","Non Conforme","Non applicable","Non évaluée"];
  const colors=["#239E4F","#e09200","#d60020","#222","#636363"];
  const datasets=labels.map((label,i)=>({
    label:label+"s",
    backgroundColor:colors[i],
    data: pilierData.map(p=>p.exigences.filter(e=>e.statut===label).length)
  }));
  barChart = new Chart(document.getElementById('bar-chart'), {
    type:'bar',
    data:{
      labels: pilierData.map(p=>`Pilier ${p.numero}`),
      datasets
    },
    options:{
      responsive:true,
      plugins: {legend:{position:'top'}},
      scales: {x: {stacked:true}, y: {stacked:true, beginAtZero:true}}
    }
  });

  if(doughnutChart) doughnutChart.destroy();
  const conformesPct=pilierData.map(p=>Math.round(100*p.exigences.filter(e=>e.statut==="Conforme").length/p.exigences.length));
  doughnutChart=new Chart(document.getElementById('doughnut-chart'),{
    type:'doughnut',
    data:{
      labels: pilierData.map(p=>`Pilier ${p.numero}`),
      datasets: [{data:conformesPct,backgroundColor:['#00FFFF','#239E4F','#800080','#FFD600','#F69716','#228bc8']}]
    },
    options: {plugins:{legend:{position:'top'}}}
  });

  if(starChart) starChart.destroy();
  const conformesCount=pilierData.map(p=>p.exigences.filter(e=>e.statut==="Conforme").length);
  starChart=new Chart(document.getElementById('star-chart'),{
    type:'radar',
    data:{
      labels:pilierData.map(p=>`Pilier ${p.numero}`),
      datasets:[{
        label:"Exigences conformes",
        data: conformesCount,
        backgroundColor:"rgba(35,158,79,0.3)",
        borderColor:"#239E4F",
        pointBackgroundColor:"#239E4F"
      }]
    },
    options: {
      plugins: {legend:{display:false}},
      scales: {r: {beginAtZero:true, max: 10, ticks: {stepSize:2}}}
    }
  });
}
function updateGauge(val){
  let color="#D32F2F";
  if(val>75) color="#238765";
  else if(val>50) color="#82E07B";
  else if(val>25) color="#FF9800";
  else if(val>0) color="#FFC107";
  if(gaugeChart) gaugeChart.destroy();
  gaugeChart = new Chart(document.getElementById('gauge-chart'),{
    type:'doughnut',
    data: {
      datasets: [{
        data: [val,100-val], backgroundColor: [color,"#e0e0e0"], borderWidth:0,
        circumference:180, rotation:270, cutout:"80%"
      }]
    },
    options: {
      plugins: {legend:{display:false}, tooltip:{enabled:false}},
      circumference:180, rotation:270, responsive:true,
      maintainAspectRatio: false
    },
    plugins:[{afterDraw(chart){
      const ctx=chart.ctx, cw=chart.width, ch=chart.height;
      const angle=Math.PI + (val/100)*Math.PI, cx=cw/2, cy=ch-3, len=Math.min(cw,ch)/2-17;
      const x2=cx+len*Math.cos(angle), y2=cy+len*Math.sin(angle);
      ctx.save(); ctx.lineWidth=6; ctx.strokeStyle="#0f161f"; ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(x2,y2); ctx.stroke(); ctx.restore();
      ctx.font="bold 1.6rem Arial"; ctx.fillStyle=color; ctx.textAlign="center"; ctx.fillText(val+"%",cx,cy-10);
    }}]
  });
}

// ----- Navigation -----
function showDashboard(){
  selectedPilier=null;
  document.getElementById('dashboard-graphs').style.display="block";
  document.getElementById('pilier-details').style.display="none";
  renderSidebar(); renderStatsBar(); renderPilierCards(); renderCharts();
}
function selectPilier(idx){
  selectedPilier=idx;
  document.getElementById('dashboard-graphs').style.display="none";
  document.getElementById('pilier-details').style.display="block";
  renderSidebar();
  renderPilierDetails();
}
// --------- VUE DÉTAILLÉE ---------
function renderPilierDetails(){
  const p = pilierData[selectedPilier];
  document.getElementById('pilier-details').innerHTML = `
    <article class="pilier-details-view">
      <h2 class="details-title" style="color:var(--title-blue-dark);text-decoration:underline;">
        Pilier ${p.numero} : ${p.titre}
      </h2>
      <div class="details-desc">${p.description}<br/><i>${p.objectifs}</i></div>
      <hr class="hr"/>
      <section>
        ${p.exigences.map((e,i)=>{
          const s=getStatusDef(e.statut||"Non évaluée");
          return `<div class="exigence-detail">
            <div class="exigence-head">
              <div class="exigence-code">${e.code}</div>
              <div>${e.titre}</div>
              <div class="status-${e.statut.replace(/\s/g,"-")}" style="color:${s.color};font-weight:${s.fontWeight||'normal'}">${s.symbol}</div>
            </div>
            <p class="exigence-desc">${e.description}</p>
            <select class="exigence-status-select" onchange="setStatus(${selectedPilier},${i},this.value)">
            ${STATUS_LABELS.map(st=>`<option value="${st.key}"${e.statut===st.key?" selected":""}>${st.key}</option>`).join("")}
            </select>
            <textarea class="exigence-comments" placeholder="Commentaires et observations" oninput="setComment(${selectedPilier},${i},this.value)">${e.commentaires||''}</textarea>
            <div class="proofs-area">
            ${[0,1,2,3,4].map(k=>`
              <div class="proof-row">
                <input type="text" maxlength="130" placeholder="Preuve ou référence ${k+1}" class="proof-text" value="${e.preuves[k]||''}" oninput="setProof(${selectedPilier},${i},${k},this.value)">
                <button class="proof-attach-btn" onclick="triggerAttach(${selectedPilier},${i},${k},event)">📎</button>
                <span class="proof-file-name">${e.fichiers[k]?e.fichiers[k].name:""}</span>
                <input type="file" class="hidden-file-input" onchange="attachFile(${selectedPilier},${i},${k},event)"/>
              </div>`).join('')}
            </div>
          </div>`;
        }).join('')}
      </section>
    </article>
  `;
}
function setStatus(p,e,v){pilierData[p].exigences[e].statut=v;saveLocal();renderPilierDetails();}
function setComment(p,e,v){pilierData[p].exigences[e].commentaires=v;saveLocal();}
function setProof(p,e,k,v){pilierData[p].exigences[e].preuves[k]=v;saveLocal();}
function triggerAttach(p,e,k,evt){evt.stopPropagation();evt.target.parentElement.querySelector('input[type=file]').click();}
function attachFile(p,e,k,evt){const f=evt.target.files[0];if(!f)return;pilierData[p].exigences[e].fichiers[k]=f;renderPilierDetails();saveLocal();}

// ---- SAVE/IMPORT/EXPORT ----
function exportReport(fmt){
  let res=`<h1>DORA - Rapport complet d'audit</h1>`;
  const s=computeStats();
  res+=`<h2>Résumé Global</h2><ul>
    <li><strong>Total Exigences:</strong> ${s.total}</li>
    <li><strong>Evaluées:</strong> ${s.evalues} (${Math.round(100*s.evalues/s.total)}%)</li>
    <li><strong>Conformes:</strong> ${s.conformes} (${Math.round(100*s.conformes/s.total)}%)</li>
    <li><strong>Partielles:</strong> ${s.partielles} (${Math.round(100*s.partielles/s.total)}%)</li>
    <li><strong>Non Conformes:</strong> ${s.nonconformes} (${Math.round(100*s.nonconformes/s.total)}%)</li>
	<li><strong>Non Applicables:</strong> ${s.nonapplicables} (${Math.round(100*s.nonapplicables/s.total)}%)</li>
  </ul>`;
  pilierData.forEach(p=>{
    res+=`<hr><h3>Pilier ${p.numero} : ${p.titre}</h3><p><em>${p.description}</em></p><ul>`;
    p.exigences.forEach(e=>{
      const st = getStatusDef(e.statut);
      res+=`<li><b>${e.code}</b>: ${e.titre} (<b style="color:${st.color}">${st.symbol||e.statut}</b>)<br />${e.description}<br/>Commentaire : ${e.commentaires||""}</li>`;
    });
    res+="</ul>";
  });
  if(fmt==="html"){
    const w = window.open();
    w.document.write('<html><head><title>Rapport DORA</title></head><body style="font-family:Arial;">'+res+'</body></html>');
    w.document.close();
  }
  else if(fmt==="pdf"){
    const doc=new window.jspdf.jsPDF();
    let y=10;
    doc.setFontSize(18); doc.text("DORA - Rapport d'audit",10,y); y+=10;
    doc.setFontSize(12);
    doc.text(`Total exigences: ${s.total}, Evaluées: ${s.evalues}, Conformes: ${s.conformes}, Partielles: ${s.partielles}, "Non conformes": ${s.nonconformes}, "Non applicables": ${s.nonapplicables}`,10,y); y+=10;
    pilierData.forEach(p=>{
      doc.setFontSize(14); doc.text(`P${p.numero} ${p.titre}`,10,y); y+=8;
      doc.setFontSize(10); doc.text(p.description,13,y); y+=7;
      p.exigences.forEach(e=>{
        doc.text(`- ${e.code} ${e.titre} [${e.statut}] ${e.commentaires||""}`,15,y);
        y+=6;if(y>275){doc.addPage();y=15;}
      }); y+=5;
    });
    doc.save("DORA_AUDIT.pdf");
  }
}
function saveData(){
  const blob=new Blob([JSON.stringify(pilierData,null,2)],{type:"application/json"});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download="dora_audit_full.json";
  a.click();
}
function triggerImport(){
  const inp=document.getElementById('import-input');inp.value=null;inp.click();
}
function importData(evt){
  const f=evt.target.files[0];if(!f)return;
  const reader=new FileReader();
  reader.onload=ev=>{
    try{
      const data=JSON.parse(ev.target.result);
      if(Array.isArray(data) && data.length>0 && 'exigences' in data[0]){
        pilierData=data;saveLocal();showDashboard();alert("Import réussi");
      }else alert("Fichier invalide (structure)");
    }catch{alert("Erreur lecture fichier importé.");}
  };
  reader.readAsText(f);
}
function resetDashboard(){if(confirm("Réinitialiser toutes les données du dashboard ?")){pilierData=makeFullPiliers();saveLocal();showDashboard();}}
function saveLocal(){localStorage.setItem('dora_audit_full',JSON.stringify(pilierData));}

// ----- Démarrage -----
window.showDashboard=showDashboard;
window.selectPilier=selectPilier;
window.setStatus=setStatus;window.setComment=setComment;window.setProof=setProof;window.triggerAttach=triggerAttach;window.attachFile=attachFile;
window.exportReport=exportReport;window.saveData=saveData;window.triggerImport=triggerImport;window.importData=importData;window.resetDashboard=resetDashboard;
window.onload=()=>{renderSidebar();renderStatsBar();renderPilierCards();renderCharts();showDashboard();};
</script>


</body></html>